{% extends 'base.html' %}
{% load static %}

{% block title %}{{ cv.name }} - CV Partagé{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="shared-cv-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="shared-cv-title">
                            <i class="fas fa-user"></i>
                            {{ cv.name }}
                        </h1>
                        <p class="shared-cv-subtitle">CV partagé par {{ cv.user.get_full_name|default:cv.user.username }}</p>
                    </div>
                    <div class="shared-cv-actions">
                        <button type="button" class="btn btn-outline-secondary" onclick="window.print()">
                            <i class="fas fa-print"></i>
                            Imprimer
                        </button>
                        {% if cv.allow_download %}
                        <button type="button" class="btn btn-primary" id="download-shared-cv">
                            <i class="fas fa-download"></i>
                            Télécharger
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="shared-cv-container">
                <div class="shared-cv-content">
                    <!-- En-tête -->
                    <div class="cv-header">
                        {% if cv.photo %}
                        <div class="cv-photo">
                            <img src="{{ cv.photo.url }}" alt="Photo de profil" class="profile-photo">
                        </div>
                        {% endif %}
                        <div class="cv-title">
                            <h1 class="cv-name">{{ cv.personal_info.first_name }} {{ cv.personal_info.last_name }}</h1>
                            <h2 class="cv-title-text">{{ cv.personal_info.title }}</h2>
                            <p class="cv-summary">{{ cv.personal_info.summary }}</p>
                        </div>
                    </div>

                    <!-- Informations de contact -->
                    <div class="cv-contact">
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <span>{{ cv.personal_info.email }}</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <span>{{ cv.personal_info.phone }}</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ cv.personal_info.location }}</span>
                        </div>
                        {% if cv.personal_info.website %}
                        <div class="contact-item">
                            <i class="fas fa-globe"></i>
                            <span>{{ cv.personal_info.website }}</span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Sections du CV -->
                    {% for section in cv.sections.all %}
                    <div class="cv-section">
                        <h3 class="section-title">{{ section.title }}</h3>
                        <div class="section-content">
                            {% if section.section_type == 'experience' %}
                                {% for item in section.experience_items.all %}
                                <div class="experience-item">
                                    <div class="item-header">
                                        <h4 class="item-title">{{ item.title }}</h4>
                                        <span class="item-period">{{ item.start_date|date:"M Y" }} - {{ item.end_date|date:"M Y"|default:"Présent" }}</span>
                                    </div>
                                    <div class="item-company">{{ item.company }}</div>
                                    <div class="item-location">{{ item.location }}</div>
                                    <div class="item-description">{{ item.description|linebreaks }}</div>
                                </div>
                                {% endfor %}
                            {% elif section.section_type == 'education' %}
                                {% for item in section.education_items.all %}
                                <div class="education-item">
                                    <div class="item-header">
                                        <h4 class="item-title">{{ item.degree }}</h4>
                                        <span class="item-period">{{ item.start_date|date:"M Y" }} - {{ item.end_date|date:"M Y"|default:"Présent" }}</span>
                                    </div>
                                    <div class="item-school">{{ item.school }}</div>
                                    <div class="item-location">{{ item.location }}</div>
                                    {% if item.gpa %}
                                    <div class="item-gpa">GPA: {{ item.gpa }}</div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            {% elif section.section_type == 'skills' %}
                                {% for item in section.skill_items.all %}
                                <div class="skill-item">
                                    <div class="skill-name">{{ item.name }}</div>
                                    <div class="skill-level">
                                        <div class="skill-bar">
                                            <div class="skill-progress" style="width: {{ item.level }}%"></div>
                                        </div>
                                        <span class="skill-percentage">{{ item.level }}%</span>
                                    </div>
                                </div>
                                {% endfor %}
                            {% elif section.section_type == 'projects' %}
                                {% for item in section.project_items.all %}
                                <div class="project-item">
                                    <div class="item-header">
                                        <h4 class="item-title">{{ item.name }}</h4>
                                        <span class="item-period">{{ item.start_date|date:"M Y" }} - {{ item.end_date|date:"M Y"|default:"Présent" }}</span>
                                    </div>
                                    <div class="item-description">{{ item.description|linebreaks }}</div>
                                    {% if item.technologies %}
                                    <div class="item-technologies">
                                        <strong>Technologies :</strong> {{ item.technologies }}
                                    </div>
                                    {% endif %}
                                    {% if item.url %}
                                    <div class="item-url">
                                        <a href="{{ item.url }}" target="_blank">{{ item.url }}</a>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            {% elif section.section_type == 'certifications' %}
                                {% for item in section.certification_items.all %}
                                <div class="certification-item">
                                    <div class="item-header">
                                        <h4 class="item-title">{{ item.name }}</h4>
                                        <span class="item-date">{{ item.date|date:"M Y" }}</span>
                                    </div>
                                    <div class="item-issuer">{{ item.issuer }}</div>
                                    {% if item.credential_id %}
                                    <div class="item-credential">ID: {{ item.credential_id }}</div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            {% elif section.section_type == 'languages' %}
                                {% for item in section.language_items.all %}
                                <div class="language-item">
                                    <div class="language-name">{{ item.name }}</div>
                                    <div class="language-level">{{ item.get_proficiency_display }}</div>
                                </div>
                                {% endfor %}
                            {% elif section.section_type == 'interests' %}
                                {% for item in section.interest_items.all %}
                                <div class="interest-item">
                                    <span class="interest-name">{{ item.name }}</span>
                                </div>
                                {% endfor %}
                            {% elif section.section_type == 'references' %}
                                {% for item in section.reference_items.all %}
                                <div class="reference-item">
                                    <div class="item-header">
                                        <h4 class="item-title">{{ item.name }}</h4>
                                        <span class="item-position">{{ item.position }}</span>
                                    </div>
                                    <div class="item-company">{{ item.company }}</div>
                                    <div class="item-contact">
                                        <span>{{ item.email }}</span>
                                        {% if item.phone %}
                                        <span> - {{ item.phone }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="custom-content">
                                    {{ section.content|linebreaks }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Section de contact -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="contact-section">
                <div class="card">
                    <div class="card-body text-center">
                        <h4>Intéressé par ce profil ?</h4>
                        <p class="text-muted">Contactez directement ce candidat</p>
                        <div class="contact-actions">
                            <a href="mailto:{{ cv.personal_info.email }}" class="btn btn-primary">
                                <i class="fas fa-envelope"></i>
                                Envoyer un email
                            </a>
                            {% if cv.personal_info.phone %}
                            <a href="tel:{{ cv.personal_info.phone }}" class="btn btn-outline-primary">
                                <i class="fas fa-phone"></i>
                                Appeler
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.shared-cv-header {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    padding: 30px 0;
    margin-bottom: 30px;
    border-radius: 12px;
}

.shared-cv-title {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 10px;
}

.shared-cv-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    margin: 0;
}

.shared-cv-actions {
    display: flex;
    gap: 10px;
}

.shared-cv-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.shared-cv-content {
    padding: 40px;
    font-family: 'Arial', sans-serif;
    line-height: 1.6;
    color: #333;
}

.cv-header {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #007bff;
}

.cv-photo {
    margin-right: 30px;
}

.profile-photo {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #007bff;
}

.cv-title {
    flex: 1;
}

.cv-name {
    font-size: 2.5rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 10px;
}

.cv-title-text {
    font-size: 1.5rem;
    color: #007bff;
    margin-bottom: 15px;
}

.cv-summary {
    font-size: 1.1rem;
    color: #6c757d;
    line-height: 1.8;
}

.cv-contact {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.contact-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #495057;
}

.contact-item i {
    color: #007bff;
    width: 16px;
}

.cv-section {
    margin-bottom: 30px;
}

.section-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #dee2e6;
}

.item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.item-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: #2c3e50;
    margin: 0;
}

.item-period, .item-date {
    color: #6c757d;
    font-size: 0.9rem;
    white-space: nowrap;
}

.item-company, .item-school {
    font-weight: bold;
    color: #007bff;
    margin-bottom: 5px;
}

.item-location {
    color: #6c757d;
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.item-description {
    color: #495057;
    line-height: 1.7;
}

.skill-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.skill-name {
    font-weight: bold;
    color: #2c3e50;
    min-width: 150px;
}

.skill-level {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
}

.skill-bar {
    flex: 1;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
}

.skill-progress {
    height: 100%;
    background: linear-gradient(90deg, #007bff, #0056b3);
    transition: width 0.3s ease;
}

.skill-percentage {
    font-size: 0.9rem;
    color: #6c757d;
    min-width: 35px;
}

.language-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.language-name {
    font-weight: bold;
    color: #2c3e50;
}

.language-level {
    color: #6c757d;
}

.interest-item {
    display: inline-block;
    margin: 5px 10px 5px 0;
    padding: 5px 12px;
    background: #e9ecef;
    border-radius: 15px;
    font-size: 0.9rem;
    color: #495057;
}

.contact-section {
    margin-top: 40px;
}

.contact-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
}

@media print {
    .shared-cv-header,
    .shared-cv-actions,
    .contact-section {
        display: none !important;
    }
    
    .shared-cv-content {
        padding: 0 !important;
    }
}

@media (max-width: 768px) {
    .shared-cv-header {
        text-align: center;
    }
    
    .shared-cv-actions {
        flex-direction: column;
        margin-top: 20px;
    }
    
    .cv-header {
        flex-direction: column;
        text-align: center;
    }
    
    .cv-photo {
        margin-right: 0;
        margin-bottom: 20px;
    }
    
    .cv-contact {
        flex-direction: column;
        gap: 10px;
    }
    
    .item-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
    
    .skill-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .skill-level {
        width: 100%;
    }
    
    .contact-actions {
        flex-direction: column;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const downloadBtn = document.getElementById('download-shared-cv');
    
    if (downloadBtn) {
        downloadBtn.addEventListener('click', function() {
            // Ici, vous implémenteriez la logique de téléchargement
            const link = document.createElement('a');
            link.href = `{% url 'cv_builder:download_shared_cv' cv.id %}`;
            link.download = `{{ cv.name }}.pdf`;
            link.click();
        });
    }
});
</script>
{% endblock %}