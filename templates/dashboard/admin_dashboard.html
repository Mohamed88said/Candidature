{% extends 'base_admin.html' %}
{% load static %}

{% block title %}Tableau de bord administrateur - Plateforme de Recrutement{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <div class="page-header-content">
            <div class="dashboard-header">
                <div class="welcome-section">
                    <h1>Tableau de bord administrateur</h1>
                    <p class="welcome-subtitle">Gestion de la plateforme de recrutement</p>
                </div>
                <div class="quick-actions">
                    <a href="{% url 'admin:index' %}" class="btn btn-primary">
                        <i class="fas fa-cog"></i>
                        <span>Administration Django</span>
                    </a>
                    <a href="{% url 'admin:accounts_user_changelist' %}" class="btn btn-outline-primary">
                        <i class="fas fa-users"></i>
                        <span>Gérer les utilisateurs</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="page-content">
    <div class="container">
        <!-- Statistics Cards -->
        <div class="stats-section">
            <div class="row">
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ total_users }}</h3>
                            <p>Utilisateurs</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ total_jobs }}</h3>
                            <p>Offres d'emploi</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ total_applications }}</h3>
                            <p>Candidatures</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ total_companies }}</h3>
                            <p>Entreprises</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- System Overview -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>Vue d'ensemble du système</h3>
                    </div>
                    <div class="section-content">
                        <div class="system-stats">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="stat-item">
                                        <div class="stat-icon">
                                            <i class="fas fa-user-check"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h4>{{ active_users }}</h4>
                                            <p>Utilisateurs actifs</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="stat-item">
                                        <div class="stat-icon">
                                            <i class="fas fa-clock"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h4>{{ pending_applications }}</h4>
                                            <p>Candidatures en attente</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="stat-item">
                                        <div class="stat-icon">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h4>{{ growth_rate }}%</h4>
                                            <p>Taux de croissance</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="stat-item">
                                        <div class="stat-icon">
                                            <i class="fas fa-server"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h4>{{ system_health }}%</h4>
                                            <p>Santé du système</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>Activité récente</h3>
                    </div>
                    <div class="section-content">
                        <div class="activity-list">
                            {% for activity in recent_activities %}
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-{{ activity.icon }}"></i>
                                </div>
                                <div class="activity-content">
                                    <h5>{{ activity.title }}</h5>
                                    <p>{{ activity.description }}</p>
                                    <span class="activity-time">{{ activity.created_at|timesince }} ago</span>
                                </div>
                            </div>
                            {% empty %}
                            <div class="empty-activity">
                                <i class="fas fa-history"></i>
                                <p>Aucune activité récente</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- System Alerts -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>Alertes système</h3>
                    </div>
                    <div class="section-content">
                        {% if system_alerts %}
                        <div class="alerts-list">
                            {% for alert in system_alerts %}
                            <div class="alert-item alert-{{ alert.level }}">
                                <div class="alert-icon">
                                    <i class="fas fa-{{ alert.icon }}"></i>
                                </div>
                                <div class="alert-content">
                                    <h5>{{ alert.title }}</h5>
                                    <p>{{ alert.message }}</p>
                                    <span class="alert-time">{{ alert.created_at|timesince }} ago</span>
                                </div>
                                <div class="alert-actions">
                                    <button class="btn btn-outline-primary btn-sm" onclick="dismissAlert({{ alert.id }})">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-alerts">
                            <i class="fas fa-check-circle"></i>
                            <p>Aucune alerte système</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Quick Actions -->
                <div class="dashboard-widget">
                    <div class="widget-header">
                        <h3>Actions rapides</h3>
                    </div>
                    <div class="widget-content">
                        <div class="quick-actions-list">
                            <a href="{% url 'admin:accounts_user_changelist' %}" class="action-item">
                                <i class="fas fa-users"></i>
                                <span>Gérer les utilisateurs</span>
                            </a>
                            <a href="{% url 'admin:jobs_job_changelist' %}" class="action-item">
                                <i class="fas fa-briefcase"></i>
                                <span>Gérer les offres</span>
                            </a>
                            <a href="{% url 'admin:applications_application_changelist' %}" class="action-item">
                                <i class="fas fa-file-alt"></i>
                                <span>Gérer les candidatures</span>
                            </a>
                            <a href="{% url 'admin:accounts_company_changelist' %}" class="action-item">
                                <i class="fas fa-building"></i>
                                <span>Gérer les entreprises</span>
                            </a>
                            <a href="{% url 'admin:push_notifications_pushnotification_changelist' %}" class="action-item">
                                <i class="fas fa-bell"></i>
                                <span>Notifications</span>
                            </a>
                            <a href="{% url 'admin:gamification_badge_changelist' %}" class="action-item">
                                <i class="fas fa-trophy"></i>
                                <span>Gamification</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="dashboard-widget">
                    <div class="widget-header">
                        <h3>Statut du système</h3>
                    </div>
                    <div class="widget-content">
                        <div class="system-status">
                            <div class="status-item">
                                <div class="status-indicator status-online"></div>
                                <span>Base de données</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator status-online"></div>
                                <span>Cache Redis</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator status-online"></div>
                                <span>Stockage Cloudinary</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator status-online"></div>
                                <span>Queue Celery</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="dashboard-widget">
                    <div class="widget-header">
                        <h3>Métriques de performance</h3>
                    </div>
                    <div class="widget-content">
                        <div class="performance-metrics">
                            <div class="metric-item">
                                <div class="metric-label">Temps de réponse moyen</div>
                                <div class="metric-value">{{ avg_response_time }}ms</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Utilisation CPU</div>
                                <div class="metric-value">{{ cpu_usage }}%</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Utilisation mémoire</div>
                                <div class="metric-value">{{ memory_usage }}%</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Espace disque</div>
                                <div class="metric-value">{{ disk_usage }}%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Users -->
                <div class="dashboard-widget">
                    <div class="widget-header">
                        <h3>Nouveaux utilisateurs</h3>
                    </div>
                    <div class="widget-content">
                        <div class="users-list">
                            {% for user in recent_users %}
                            <div class="user-item">
                                <div class="user-avatar">
                                    {% if user.profile_picture %}
                                    <img src="{{ user.profile_picture.url }}" alt="{{ user.get_full_name }}">
                                    {% else %}
                                    <div class="avatar-placeholder">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="user-info">
                                    <h5>{{ user.get_full_name }}</h5>
                                    <p>{{ user.get_user_type_display }}</p>
                                    <span class="user-date">{{ user.date_joined|date:"d/m/Y" }}</span>
                                </div>
                            </div>
                            {% empty %}
                            <div class="empty-users">
                                <i class="fas fa-users"></i>
                                <p>Aucun nouvel utilisateur</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Dismiss alert functionality
    function dismissAlert(alertId) {
        // This would typically make an AJAX request to dismiss the alert
        alert('Alerte supprimée avec succès !');
    }
    
    // Auto-refresh dashboard data
    setInterval(function() {
        // This would typically refresh dashboard statistics
        console.log('Refreshing admin dashboard data...');
    }, 30000); // Refresh every 30 seconds
</script>
{% endblock %}